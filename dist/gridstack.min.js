!function(a,b){var c={is_intercepted:function(a,b){return!(a.x+a.width<=b.x||b.x+b.width<=a.x||a.y+a.height<=b.y||b.y+b.height<=a.y)},sort:function(a,c,d){return d=d||b.chain(a).map(function(a){return a.x+a.width}).max().value(),c=-1!=c?1:-1,b.sortBy(a,function(a){return c*(a.x+a.y*d)})},create_stylesheet:function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet},toBool:function(a){return"boolean"==typeof a?a:"string"==typeof a?(a=a.toLowerCase(),!(""==a||"no"==a||"false"==a||"0"==a)):Boolean(a)}},d=0,e=function(a,b,c,d,e){this.width=a,this.float=c||!1,this.height=d||0,this.nodes=e||[],this.onchange=b||function(){}};e.prototype._fix_collisions=function(a){for(this._sort_nodes(-1);;){var d=b.find(this.nodes,function(b){return b!=a&&c.is_intercepted(b,a)},this);if("undefined"==typeof d)return;this.move_node(d,d.x,a.y+a.height,d.width,d.height,!0)}},e.prototype._sort_nodes=function(a){this.nodes=c.sort(this.nodes,a,this.width)},e.prototype._pack_nodes=function(){this._sort_nodes(),this.float?b.each(this.nodes,function(a){if(!a._updating&&"undefined"!=typeof a._orig_y&&a.y!=a._orig_y)for(var e=a.y;e>=a._orig_y;){var f=b.chain(this.nodes).find(function(b){return a!=b&&c.is_intercepted({x:a.x,y:e,width:a.width,height:a.height},b)}).value();f||(a._dirty=!0,a.y=e),--e}},this):b.each(this.nodes,function(a,d){if(!a.locked)for(;a.y>0;){var e=a.y-1,f=0==d;if(d>0){var g=b.chain(this.nodes).first(d).find(function(b){return c.is_intercepted({x:a.x,y:e,width:a.width,height:a.height},b)}).value();f="undefined"==typeof g}if(!f)break;a._dirty=a.y!=e,a.y=e}},this)},e.prototype._prepare_node=function(a,c){return a=b.defaults(a||{},{width:1,height:1,x:0,y:0}),a.x=parseInt(""+a.x),a.y=parseInt(""+a.y),a.width=parseInt(""+a.width),a.height=parseInt(""+a.height),a.auto_position=a.auto_position||!1,a.no_resize=a.no_resize||!1,a.no_move=a.no_move||!1,a.width>this.width?a.width=this.width:a.width<1&&(a.width=1),a.height<1&&(a.height=1),a.x<0&&(a.x=0),a.x+a.width>this.width&&(c?a.width=this.width-a.x:a.x=this.width-a.width),a.y<0&&(a.y=0),a},e.prototype._notify=function(){var a=Array.prototype.slice.call(arguments,1).concat(this.get_dirty_nodes());a=a.concat(this.get_dirty_nodes()),this.onchange(a)},e.prototype.clean_nodes=function(){b.each(this.nodes,function(a){a._dirty=!1})},e.prototype.get_dirty_nodes=function(){return b.filter(this.nodes,function(a){return a._dirty})},e.prototype.add_node=function(a){if(a=this._prepare_node(a),"undefined"!=typeof a.max_width&&(a.width=Math.min(a.width,a.max_width)),"undefined"!=typeof a.max_height&&(a.height=Math.min(a.height,a.max_height)),"undefined"!=typeof a.min_width&&(a.width=Math.max(a.width,a.min_width)),"undefined"!=typeof a.min_height&&(a.height=Math.max(a.height,a.min_height)),a._id=++d,a._dirty=!0,a.auto_position){this._sort_nodes();for(var e=0;;++e){var f=e%this.width,g=Math.floor(e/this.width);if(!(f+a.width>this.width||b.find(this.nodes,function(b){return c.is_intercepted({x:f,y:g,width:a.width,height:a.height},b)}))){a.x=f,a.y=g;break}}}return this.nodes.push(a),this._fix_collisions(a),this._pack_nodes(),this._notify(),a},e.prototype.remove_node=function(a){a._id=null,this.nodes=b.without(this.nodes,a),this._pack_nodes(),this._notify(a)},e.prototype.can_move_node=function(a,c,d,f,g){var h=Boolean(b.find(this.nodes,function(a){return a.locked}));if(!this.height&&!h)return!0;var i,j=new e(this.width,null,this.float,0,b.map(this.nodes,function(b){return b==a?i=$.extend({},b):$.extend({},b)}));j.move_node(i,c,d,f,g);var k=!0;return h&&(k&=!Boolean(b.find(j.nodes,function(a){return a!=i&&Boolean(a.locked)&&Boolean(a._dirty)}))),this.height&&(k&=j.get_grid_height()<=this.height),k},e.prototype.can_be_placed_with_respect_to_height=function(a){if(!this.height)return!0;var c=new e(this.width,null,this.float,0,b.map(this.nodes,function(a){return $.extend({},a)}));return c.add_node(a),c.get_grid_height()<=this.height},e.prototype.move_node=function(a,b,c,d,e,f){if("number"!=typeof b&&(b=a.x),"number"!=typeof c&&(c=a.y),"number"!=typeof d&&(d=a.width),"number"!=typeof e&&(e=a.height),"undefined"!=typeof a.max_width&&(d=Math.min(d,a.max_width)),"undefined"!=typeof a.max_height&&(e=Math.min(e,a.max_height)),"undefined"!=typeof a.min_width&&(d=Math.max(d,a.min_width)),"undefined"!=typeof a.min_height&&(e=Math.max(e,a.min_height)),a.x==b&&a.y==c&&a.width==d&&a.height==e)return a;var g=a.width!=d;return a._dirty=!0,a.x=b,a.y=c,a.width=d,a.height=e,a=this._prepare_node(a,g),this._fix_collisions(a),f||(this._pack_nodes(),this._notify()),a},e.prototype.get_grid_height=function(){return b.reduce(this.nodes,function(a,b){return Math.max(a,b.y+b.height)},0)},e.prototype.begin_update=function(a){b.each(this.nodes,function(a){a._orig_y=a.y}),a._updating=!0},e.prototype.end_update=function(){var a=b.find(this.nodes,function(a){return a._updating});a&&(a._updating=!1)};var f=function(a,d){var g,f=this;this.container=$(a),this.opts=b.defaults(d||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,item_class:"grid-stack-item",placeholder_class:"grid-stack-placeholder",handle:".grid-stack-item-content",cell_height:60,vertical_margin:20,auto:!0,min_width:768,"float":!1,_class:"grid-stack-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1}),this.container.addClass(this.opts._class),this._styles=c.create_stylesheet(),this._styles._max=0,this.grid=new e(this.opts.width,function(a){var c=0;b.each(a,function(a){null==a._id?a.el.remove():(a.el.attr("data-gs-x",a.x).attr("data-gs-y",a.y).attr("data-gs-width",a.width).attr("data-gs-height",a.height),c=Math.max(c,a.y+a.height))}),f._update_styles(c+10)},this.opts.float,this.opts.height),this.opts.auto&&this.container.find("."+this.opts.item_class).each(function(a,b){f._prepare_element(b)}),this.set_animation(this.opts.animate),this.placeholder=$('<div class="'+this.opts.placeholder_class+" "+this.opts.item_class+'"><div class="placeholder-content" /></div>').hide(),this.container.append(this.placeholder),this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin);var h=function(){if(f._is_one_column_mode()){if(g)return;g=!0,b.each(f.grid.nodes,function(a){a.no_move||a.el.draggable("disable"),a.no_resize||a.el.resizable("disable")})}else{if(!g)return;g=!1,b.each(f.grid.nodes,function(a){a.no_move||a.el.draggable("enable"),a.no_resize||a.el.resizable("enable")})}};$(window).resize(h),h()};f.prototype._update_styles=function(a){if("undefined"==typeof a){for(a=this._styles._max,this._styles._max=0;this._styles.rules.length;)this._styles.removeRule(0);this._update_container_height()}if(a>this._styles._max){for(var b=this._styles._max;a>b;++b){var c;c="."+this.opts._class+" ."+this.opts.item_class+'[data-gs-height="'+(b+1)+'"] { height: '+(this.opts.cell_height*(b+1)+this.opts.vertical_margin*b)+"px; }",this._styles.insertRule(c,b),c="."+this.opts._class+" ."+this.opts.item_class+'[data-gs-y="'+b+'"] { top: '+(this.opts.cell_height*b+this.opts.vertical_margin*b)+"px; }",this._styles.insertRule(c,b)}this._styles._max=a}},f.prototype._update_container_height=function(){this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin)},f.prototype._is_one_column_mode=function(){return $(window).width()<=this.opts.min_width},f.prototype._prepare_element=function(a){var d=this;a=$(a),a.addClass(this.opts.item_class);var e=d.grid.add_node({x:a.attr("data-gs-x"),y:a.attr("data-gs-y"),width:a.attr("data-gs-width"),height:a.attr("data-gs-height"),max_width:a.attr("data-gs-max-width"),min_width:a.attr("data-gs-min-width"),max_height:a.attr("data-gs-max-height")||100,min_height:a.attr("data-gs-min-height"),auto_position:c.toBool(a.attr("data-gs-auto-position")),no_resize:c.toBool(a.attr("data-gs-no-resize")),no_move:c.toBool(a.attr("data-gs-no-move")),locked:c.toBool(a.attr("data-gs-locked")),el:a});a.data("_gridstack_node",e);var f,g,h=function(){var c=$(this);d.grid.clean_nodes(),d.grid.begin_update(e),f=Math.ceil(c.outerWidth()/c.attr("data-gs-width")),g=d.opts.cell_height+d.opts.vertical_margin,d.placeholder.attr("data-gs-x",c.attr("data-gs-x")).attr("data-gs-y",c.attr("data-gs-y")).attr("data-gs-width",c.attr("data-gs-width")).attr("data-gs-height",c.attr("data-gs-height")).show(),e.el=d.placeholder},i=function(){var f=$(this);e.el=f,d.placeholder.hide(),f.attr("data-gs-x",e.x).attr("data-gs-y",e.y).attr("data-gs-width",e.width).attr("data-gs-height",e.height).removeAttr("style"),d._update_container_height(),d.container.trigger("change",[d.grid.get_dirty_nodes()]),d.grid.end_update(),d.grid._sort_nodes(),setTimeout(function(){b.each(d.grid.nodes,function(a){a.el.detach(),d.container.append(a.el)})},d.opts.animate?300:0)};a.draggable({handle:this.opts.handle,scroll:!0,appendTo:"body",start:h,stop:i,drag:function(a,b){var c=Math.round(b.position.left/f),h=Math.floor((b.position.top+g/2)/g);d.grid.can_move_node(e,c,h,e.width,e.height)&&(d.grid.move_node(e,c,h),d._update_container_height())}}).resizable({autoHide:!0,handles:"se",minHeight:this.opts.cell_height-10,minWidth:70,start:h,stop:i,resize:function(a,b){var c=Math.round(b.size.width/f),h=Math.round(b.size.height/g);d.grid.can_move_node(e,e.x,e.y,c,h)&&(d.grid.move_node(e,e.x,e.y,c,h),d._update_container_height())}}),(e.no_move||this._is_one_column_mode())&&a.draggable("disable"),(e.no_resize||this._is_one_column_mode())&&a.resizable("disable"),a.attr("data-gs-locked",e.locked?"yes":null)},f.prototype.set_animation=function(a){a?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},f.prototype.add_widget=function(a,b,c,d,e,f){a=$(a),"undefined"!=typeof b&&a.attr("data-gs-x",b),"undefined"!=typeof c&&a.attr("data-gs-y",c),"undefined"!=typeof d&&a.attr("data-gs-width",d),"undefined"!=typeof e&&a.attr("data-gs-height",e),"undefined"!=typeof f&&a.attr("data-gs-auto-position",f?"yes":null),this.container.append(a),this._prepare_element(a),this._update_container_height()},f.prototype.will_it_fit=function(a,b,c,d,e){var f={x:a,y:b,width:c,height:d,auto_position:e};return this.grid.can_be_placed_with_respect_to_height(f)},f.prototype.remove_widget=function(a){a=$(a);var b=a.data("_gridstack_node");this.grid.remove_node(b),a.remove(),this._update_container_height()},f.prototype.remove_all=function(){b.each(this.grid.nodes,function(a){a.el.remove()}),this.grid.nodes=[],this._update_container_height()},f.prototype.resizable=function(a,b){return a=$(a),a.each(function(a,c){c=$(c);var d=c.data("_gridstack_node");"undefined"!=typeof d&&(d.no_resize=!b,d.no_resize?c.resizable("disable"):c.resizable("enable"))}),this},f.prototype.movable=function(a,b){return a=$(a),a.each(function(a,c){c=$(c);var d=c.data("_gridstack_node");"undefined"!=typeof d&&(d.no_move=!b,d.no_move?c.draggable("disable"):c.draggable("enable"))}),this},f.prototype.locked=function(a,b){return a=$(a),a.each(function(a,c){c=$(c);var d=c.data("_gridstack_node");"undefined"!=typeof d&&(d.locked=b||!1,c.attr("data-gs-locked",d.locked?"yes":null))}),this},f.prototype._update_element=function(a,c){a=$(a).first();var d=a.data("_gridstack_node");if("undefined"!=typeof d){var e=this;e.grid.clean_nodes(),e.grid.begin_update(d),c.call(this,a,d),e._update_container_height(),e.container.trigger("change",[e.grid.get_dirty_nodes()]),e.grid.end_update(),e.grid._sort_nodes(),b.each(e.grid.nodes,function(a){a.el.detach(),e.container.append(a.el)})}},f.prototype.resize=function(a,b,c){this._update_element(a,function(a,d){b=null!=b&&"undefined"!=typeof b?b:d.width,c=null!=c&&"undefined"!=typeof c?c:d.height,this.grid.move_node(d,d.x,d.y,b,c)})},f.prototype.move=function(a,b,c){this._update_element(a,function(a,d){b=null!=b&&"undefined"!=typeof b?b:d.x,c=null!=c&&"undefined"!=typeof c?c:d.y,this.grid.move_node(d,b,c,d.width,d.height)})},f.prototype.cell_height=function(a){return"undefined"==typeof a?this.opts.cell_height:(a=parseInt(a),a!=this.opts.cell_height&&(this.opts.cell_height=a||this.opts.cell_height,this._update_styles()),void 0)},f.prototype.cell_width=function(){var a=this.container.find("."+this.opts.item_class).first();return Math.ceil(a.outerWidth()/a.attr("data-gs-width"))},a.GridStackUI=f,a.GridStackUI.Utils=c,$.fn.gridstack=function(a){return this.each(function(){$(this).data("gridstack")||$(this).data("gridstack",new f(this,a))})}}(window,_);